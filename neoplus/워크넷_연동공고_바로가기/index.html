<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>워크넷_연동공고_바로가기</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            text-align: center;
        }
        #inputGroup {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 15px;
        }
        #inputUrl {
            width: 80%;
            max-width: 600px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        
        /* 추출된 공고번호 표시 영역 스타일 */
        #valueDisplay {
            margin: 15px 0;
            font-size: 1.1em;
            color: #555;
            font-weight: bold;
        }
        #extractedIndexDisplay {
            color: red; /* 추출된 값은 붉은색 */
            margin-left: 10px;
            font-weight: bold;
        }

        #linkButton {
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 10px; /* 버튼 위에 공간 추가 */
        }
        #linkButton:hover {
            background-color: #45a049;
        }
        #errorMessage {
            color: red;
            margin-top: 10px;
        }
    </style>
</head>
<body>

    <h2>워크넷 링크 연결 도우미</h2>
    <p>아래 입력창에 **공고URL** 또는 **공고번호**를 붙여 넣어주세요.</p>
    
    <div id="inputGroup">
        <input 
            type="text" 
            id="inputUrl" 
            placeholder="예: URL 전체 또는 공고번호 212726" 
            oninput="showExtractedValue()"
            onkeydown="handleEnter(event)" 
        >
    </div>
    
    <div id="valueDisplay">
        추출된 공고번호: 
        <span id="extractedIndexDisplay">입력 대기 중...</span>
    </div>

    <button id="linkButton" onclick="openWorknetLink()">링크 열기</button>
    
    <p id="errorMessage"></p>

    <script>
        /**
         * 입력 문자열에서 공고번호를 추출합니다.
         */
        function extractIndex(inputStr) {
            const trimmedStr = inputStr.trim();
            
            // 1. 숫자만 입력되었는지 확인 (정규식: ^\d+$)
            if (/^\d+$/.test(trimmedStr)) {
                return trimmedStr; 
            }

            // 2. URL 파라미터 추출 시도
            try {
                const url = new URL(trimmedStr);
                return url.searchParams.get('srchJopblancIdx');
            } catch (e) {
                return null;
            }
        }
        
        function showExtractedValue() {
            const inputElement = document.getElementById('inputUrl');
            const jobgroundUrl = inputElement.value.trim();
            const displayElement = document.getElementById('extractedIndexDisplay');
            const extractedIndex = extractIndex(jobgroundUrl);
            const errorMessage = document.getElementById('errorMessage');
            
            errorMessage.textContent = "";
            
            if (extractedIndex) {
                displayElement.textContent = extractedIndex;
                displayElement.style.color = 'red';
            } else if (jobgroundUrl === "") {
                displayElement.textContent = "입력 대기 중...";
                displayElement.style.color = '#777'; // 대기 중일 때는 회색
            } else {
                displayElement.textContent = "추출 실패";
                displayElement.style.color = 'red';
            }
        }
        
        /**
         * 입력창에서 키 입력 이벤트를 처리하여 Enter 키일 경우 링크를 엽니다.
         */
        function handleEnter(event) {
            // Enter 키 (key 'Enter' 또는 keyCode 13)인지 확인
            if (event.key === 'Enter' || event.keyCode === 13) {
                event.preventDefault(); // 기본 Enter 동작(폼 제출 등) 방지
                openWorknetLink(); // 링크 열기 함수 호출
            }
        }

        // 새 팝업 창으로 워크넷 링크 열기
        function openWorknetLink() {
            const jobgroundUrl = document.getElementById('inputUrl').value.trim();
            const errorMessage = document.getElementById('errorMessage');
            
            const wantedAuthNo = extractIndex(jobgroundUrl);

            if (!wantedAuthNo) {
                errorMessage.textContent = "입력에서 유효한 공고번호를 추출할 수 없습니다. URL 또는 공고번호를 확인해주세요.";
                return;
            }

            // 1. 새로운 Worknet URL 생성
            const worknetBaseUrl = "https://www.work24.go.kr/wk/a/b/1500/empDetailAuthView.do?";
            const worknetParams = new URLSearchParams({
                wantedAuthNo: wantedAuthNo,
                infoTypeCd: 'KOS',
                infoTypeGroup: 'tb_workinfogubun'
            });
            
            const finalUrl = worknetBaseUrl + worknetParams.toString();
            
            // 2. 새 창의 크기와 옵션 설정 (800x600, 중앙 정렬)
            const width = 800;
            const height = 600;
            const left = (window.screen.width / 2) - (width / 2);
            const top = (window.screen.height / 2) - (height / 2);

            const features = `width=${width},height=${height},top=${top},left=${left},scrollbars=yes,resizable=yes`;
            
            // 3. 설정된 크기와 위치로 새 팝업 창 열기
            window.open(finalUrl, 'worknetPopup', features);

            // 입력 필드 비우기 및 미리보기 초기화
            document.getElementById('inputUrl').value = '';
            showExtractedValue();
        }
    </script>

</body>
</html>
